$(function(){'use strict';var $searchInput=$('#wd');var $autocomplete=$('#word');var $api='./api.php?tp=jsonp&wd=';$searchInput.attr('autocomplete','off');var selectedItem=null;var timeoutid=null;var setSelectedItem=function(item){selectedItem=item;if(selectedItem<0){selectedItem=$autocomplete.find('div').length-1;}
else if(selectedItem>$autocomplete.find('div').length-1){selectedItem=0;}
$autocomplete.find('div').removeClass('click_hover');$autocomplete.find('div').eq(selectedItem).addClass('click_hover');};var removeHTMLTag=function(str){str=str.replace(/&quot;/g,'"');str=str.replace(/\+/g," ");str=str.replace(/[ | ]*\n/g,'\n');str=str.replace(/\n[\s| | ]*\r/g,'\n');str=str.replace(/<\/?.*?$/g,'');return str;};$searchInput.keyup(function(event){var keywords=$(this).val();var ajax_request=function(){if(keywords===''){$autocomplete.hide();return;}
$.ajax({url:$api+keywords,dataType:'jsonp',jsonp:'cb',success:function(data){if(data.success){$autocomplete.empty().show();$.each(data.info,function(index,term){var title=removeHTMLTag(decodeURIComponent(term.title));$('<div ></div>').text(title).appendTo($autocomplete).addClass('click_work').hover(function(){$(this).siblings().removeClass('click_hover');$(this).addClass('click_hover');selectedItem=index;},function(){$(this).removeClass('click_hover');selectedItem=-1;}).click(function(){$searchInput.val(title);$autocomplete.empty().hide();$('#submit').trigger('click');});});setSelectedItem(0);}}});}
if(event.keyCode>40||event.keyCode===8||event.keyCode===32){$autocomplete.empty().hide();clearTimeout(timeoutid);timeoutid=setTimeout(ajax_request,100);}else if(event.keyCode===38){if(selectedItem===-1){setSelectedItem($autocomplete.find('div').length-1);}else{setSelectedItem(selectedItem-1);}
event.preventDefault();}else if(event.keyCode===40){if(selectedItem===-1){setSelectedItem(0);}else{setSelectedItem(selectedItem+1);}
event.preventDefault();}});$searchInput.keypress(function(event){if(event.keyCode===13)
{if($autocomplete.find('div').length===0||selectedItem===-1){return;}
$searchInput.val($autocomplete.find('div').eq(selectedItem).text());$autocomplete.empty().hide();$('#submit').trigger('click');event.preventDefault();}});$searchInput.keydown(function(event){if(event.keyCode===27){$autocomplete.empty().hide();event.preventDefault();}});$("input").blur(function(){setTimeout(function(){$autocomplete.hide();},500);});});